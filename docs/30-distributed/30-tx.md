分布式事务

- XA/2PC/3PC
- 本地事务表（本地消息表）
- MQ事务
- 尽最大努力通知
- TCC
- festa/seata

### XA方案 - 数据库层面
2PC/3PC
- DTP模型，Distributed Transaction Processing Reference Model，X/Open组织
  - AP（Application Program）
  - RM（Resource Manager）
  - TM（Transaction Manager）
  - DTP 模型定义TM和RM之间通讯的接口规范叫 XA
- 调用者-协调者-数据库1、数据库2、数据库N
- 强一致性事务，有数据不一致、阻塞等风险

### TCC方案 - 业务层面
Try - Confirm - Cancel

- 调用者-事务管理者-服务1、服务2、服务N
- TCC 对业务的侵入较大和业务紧耦合
- 撤销和确认操作的执行可能需要重试，因此还需要保证操作的幂等

### 本地事务表（本地消息表）
- 将**业务的执行**和将**消息放入消息表中**的操作放在同一个事务中
- 后台任务定时去读取本地消息表
- 重试，幂等
- 最终一致性

### MQ事务

### 最大努力通知
最大努力通知其实只是表明了一种柔性事务的思想：我已经尽力我最大的努力想达成事务的最终一致了。

最大努力通知也被称为定期校对，其实是对MQ事务解决方案的进一步优化。它引入了本地消息表来记录错误消息，
然后加入失败消息的定期校对功能，来进一步保证消息会被下游系统消费。

### Seata方案
通过对本地关系数据库的分支事务的协调来完成全局事务，工作在应用层的中间件。目前提供AT模式（2PC）及TCC模式的分布式事务解决方案。

- Transaction Coordinator（TC） 事务协调器，它是独立的中间件，需要独立部署运行，它维护全局事务的运行状态，接收TM指令发起全局事务的提交或回滚，负责与RM通信协调各各分支事务的提交或回滚
- Transaction Manager（TM） 事务管理器，TM需要嵌入应用程序中工作，它负责开启一个全局事务，并最终向TC发起全局提交或全局回滚的指令
- Resource Manager（RM） 控制分支事务，负责分支注册、状态汇报，并接收事务协调器TC的指令，驱动分支事务的提交或回滚。

1. 开启全局事务 XID
2. 注册分支
3. TC协调其他RM提交或回滚

