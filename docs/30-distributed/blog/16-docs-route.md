## 服务路由

## 1. 简介
服务目录在刷新 Invoker 列表的过程中，会通过 Router 进行服务路由，筛选出符合路由规则的服务提供者。

### 服务路由是什么
服务路由包含一条路由规则，路由规则决定了服务消费者的调用目标，即规定了服务消费者可调用哪些服务提供者。

### Dubbo三种服务路由
1. 条件路由 ConditionRouter
2. 脚本路由 ScriptRouter
3. 标签路由 TagRouter 2.7.x 版本

## 2. 源码分析

```
[服务消费者匹配条件] => [服务提供者匹配条件]
// 该条规则表示 IP 为 10.20.153.10 的服务消费者只可调用 IP 为 10.20.153.11 机器上的服务，不可调用其他机器上的服务。
host = 10.20.153.10 => host = 10.20.153.11

```

### 2.1 条件路由
对用户配置的路由规则进行解析，得到一系列的条件，然后再根据这些条件对服务进行路由。

#### 2.1.1 表达式解析
条件路由规则是一条字符串，对于 Dubbo 来说，它并不能直接理解字符串的意思，需要将其解析成内部格式才行。条件表达式的解析过程始于 ConditionRouter 的构造方法

#### 2.1.2 服务路由
服务路由的入口方法是 ConditionRouter 的 router 方法，该方法定义在 Router 接口中。

### 2.2 脚本路由

