
* [高并发下接口幂等性解决方案](https://www.cnblogs.com/linjiqin/p/9678022.html)
* [幂等和高并发在电商系统中的使用](https://www.cnblogs.com/RunForLove/p/5640949.html)

* 锁的方式 悲观锁、乐观锁、分布式锁
* 唯一索引或唯一组合索引 防重表
* 条件更新 多版本并发控制（MVVC）

具体分类：
1. 查询操作 select是天然的幂等操作
2. 删除操作 删除操作也是幂等的
3. 唯一索引，防止新增脏数据。唯一索引或唯一组合索引来防止新增数据存在脏数据（资金账户表中的用户ID加唯一索引 ）
4. token机制，防止页面重复提交 
5. 悲观锁  获取数据的时候加锁获取 select * from table_xxx where id='xxx' for update; 
6. 乐观锁 乐观锁只是在更新数据那一刻锁表，其他时间不锁表，所以相对于悲观锁，效率更高。 通过version或者其他状态条件（库存大于0、金额大于0等）
7. 分布式锁 通过第三方的系统(redis或zookeeper)，在业务系统插入数据或者更新数据，获取分布式锁
8. select + insert 
9. 状态机幂等 
10. api 接口幂等 source来源，seq序列号 
    如银联提供的付款接口：需要接入商户提交付款请求时附带：source来源，seq序列号；source+seq在数据库里面做唯一索引，防止多次付款(并发时，只能处理一个请求) 。
重点：对外提供接口为了支持幂等调用，接口有两个字段必须传，一个是来源source，一个是来源方序列号seq，这个两个字段在提供方系统里面做联合唯一索引，这样当第三方调用时，先在本方系统里面查询一下，是否已经处理过，返回相应处理结果；没有处理过，进行相应处理，返回结果。注意，为了幂等友好，一定要先查询一下，是否处理过该笔业务，不查询直接插入业务系统，会报错，但实际已经处理了。

## 幂等
幂等性是系统的接口对外一种承诺(而不是实现), 承诺只要调用接口成功, 外部多次调用对系统的影响是一致的。

在HTTP1.1规范中定义幂等性。
从定义上看，HTTP方法的幂等性是指一次和多次请求某一个资源应该具有同样的作用


也就是说，多次点击提交的时候，附带提交的还有服务端生成的token，由于多次提交带的是同一个token，所以服务端对于同一个token的post订单，至多只会处理一次，所以间接的实现了幂等性的控制。
