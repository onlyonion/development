《Redis设计与实现》 黄建宏

* Redis 数据结构与算法
* 单机、集群数据库
* 发布订阅、事务、排序、慢查询、监视器

## 第1章 引言

# 第一部分 数据结构与对象
* 底层实现数据结构
* Redis的对象处理机制以及数据库的实现原理

## 第2章 简单动态字符串
Simple Dynamic String，简单动态字符串 
```c++
// sds.h/sdshdr
struct sdshdr {
    // 记录buff数组中已使用字节的数量，等于SDS所保存字符串的长度
    int len;
    // 记录buf数组中未使用字节的数量
    int free;
    char buf[];
}
```

## 第3章 链表
### 3.3 重点回顾
* 每个链表节点由一个listNode结构来表示，每个节点都有一个指向前置节点和后置节点的指针，双端链表
* 每个链表使用一个list结构来表示，这个结构带有表头节点指针、表尾节点指针，以及链表长度等信息。

## 第4章 字典
字典，又称为符号表、关联数组或映射，是一种用于保存键值对的抽象数据结构。
### 4.1 字典的实现
### 4.2 哈希算法
### 4.3 解决键冲突
使用链地址法解决键冲突，每个哈希表节点都有一个next指针，多个哈希表节点可以用next指针构成一个**单向链表**，被分配到
同一个索引上的多个节点可以用这个单向链表连接起来。
### 4.4 rehash
键值对逐渐增多或者减少，为了让负载因子维持一个合理的范围之内，当哈希表保存的键值对数量太多或者太少时，需要对哈希表
进行相应的扩展或者收缩。

### 4.5 渐进式rehash
### 4.6 字典API

## 第5章 跳跃表
skiplist是一种有序数据结构，通过在每个节点中维持多个指向其他节点的指针，从而达到快速访问节点的目标。
有序集合键的底层实现之一。

Redis中两个地方用了跳跃表，实现有序集合键，集群节点中用作内部数据结构。

## 第6章 整数集合
intset是集合键的底层实现之一。当一个集合只包含整数值元素，并且这个集合的元素数量不多时。

## 第7章 压缩列表
ziplist是列表键合哈希键的底层实现之一。

### 7.1 压缩列表的构成
压缩列表是Redis为了节约内存而开发的，是由一系列特殊编码的连续内存块组成的顺序型数据结构。一个压缩列表可以包含任意
多个节点，每个节点可以保存一个字节数组或者一个整数值。

## 第8章 对象
Redis并没有直接使用这些数据结构，而是基于这些数据结构创建了一个对象系统，这个系统包含字符串对象、列表对象、哈希对象、
集合对象和有序集合对象。

Redis的对象系统实现了基于引用计数的内存回收机制。通过引用计数实现了对象的共享机制。

# 第二部分 单机数据库的实现
## 第9章 数据库
## 第10章 RDB持久化
### 10.5 
* save 服务器进程执行保存操作，会阻塞服务
* bgsave 子进程执行保存操作，不会阻塞

## 第11章 AOF持久化
### 11.4
* aof 
* AOF重写 产生一个新的AOF文件，体积更小

## 第12章 事件
### 12.4 
* Redis服务器是一个事件驱动程序，时间事件、文件事件
* 文件事件处理器是基于Reactor模式实现的网络通信程序
  - 对套接字操作的抽象，每次套接字变为可应答（acceptable）、可写、可读时，相应的事件就会产生 
  - AE_READBlE读事件、AE_WRITABLE写事件
* 时间事件可分为定时事件（指定时间）和周期性事件（每隔一段时间）。

## 第13章 客户端
## 第14章 服务器
### 14.4
* 一个命令请求
  1. 客户端将命令请求发送到服务器
  2. 服务器读取命令请求，并分析出命令参数
  3. 命令执行器根据参数查找命令的实现函数，然后执行实现函数并得出命令回复
  4. 服务器将命令回复返回给客户端 
* serverCron函数默认每隔100毫秒执行一次，它的主要工作包括更新服务器状态、处理服务器接受的sigterm信号，
  管理客户端资源和数据库连接，检查并执行持久化操作
* 服务器启动到处理客户端命令
  1. 初始化服务器状态
  2. 载入服务器配置
  3. 初始化服务器数据结构
  4. 还原数据库状态
  5. 执行事件循环 

# 第三部分 多机数据库的实现
## 第15章 复制
## 第16章 Sentinel
## 第17章 集群
Redis集群，提供分布式数据库方案，集群通过切片来进行数据库共享，并提供复制和故障转移功能。

# 第四部分 独立功能的实现
## 第18章 发布与订阅
## 第19章 事务
## 第20章 Lua脚本
## 第21章 排序
## 第22章 二进制位数组
## 第23章 慢查询日志
## 第24章 监视器