《Java虚拟机规范（Java SE 8版）》 [美] Tim Lindholm, Frank Yellin 爱飞翔 周志明 等译

* 二、Java虚拟机结构
* 三、Java虚拟机编译器
* 四、class文件格式
* 五、加载、链接与初始化
* 六、Java虚拟机指令集
* 七、操作码助记符

## 第1章 引言
### 1.1 简史
### 1.2 Java虚拟机
整个Java平台的基石，是Java技术用以实现硬件无关与操作系统无关的关键部分。
拥有自己的指令集以及各种运行时内存区域。
### 1.3 各章节摘要
### 1.4 说明
### 1.5 反馈

## 第2章 Java虚拟机结构
### 2.1 class文件格式
平台中立的二级制格式，并且经常（但并非绝对）以文件的形式存储。
### 2.2 数据类型
原始类型和引用类型。与之对应，原始值和引用值。
### 2.3 原始类型与值
* 数值类型
  * 整数类型 byte 8bit; short 16bit; int 32bit; long 64bit; char 16bit无符号
  * 浮点类型 float; double
* boolean类型
* returnAddress类型时指向某个操作码（opcode）的指针。

### 2.4 引用类型与值
Java虚拟机中有三种引用类型：类类型(class type)、数组类型(array type)、接口类型(interface type)。
数组类型最外面那一维元素的类型，叫做数组类型的**组件类型**（component type）。

### 2.5 运行时数据区
#### 2.5.1 pc寄存器
#### 2.5.2 Java虚拟机栈
#### 2.5.3 Java堆
#### 2.5.4 方法区
#### 2.5.5 运行时常量池
#### 2.5.6 本地方法栈

### 2.6 栈帧
#### 2.6.1 局部变量表
#### 2.6.2 操作数栈
#### 2.6.3 动态链接
#### 2.6.4 方法调用正常完成
#### 2.6.5 方法调用异常完成

### 2.7 对象的表示
### 2.8 浮点算法
### 2.9 特殊方法
### 2.10 异常

### 2.11 字节码指令集简介
Java虚拟机的指令由一个字节长度的、代表某种特定操作含义的**操作码**（opcode）以及跟随其后的零至多个代表此操作所需参数的**操作数**（operand）所构成。
虚拟机中许多指令并不包含操作数，只有一个操作码。

```ts
// 忽略异常处理，Java虚拟机的解释器伪代码
do {
    自动计算pc寄存器以及从pc寄存器的位置取出操作码; // method
    if (存在操作数) 取出操作数; // args
    执行操作码锁定义的操作; // method.invoke(args)
} while (处理下一次循环)
```

限制Java虚拟机操作码的长度为一个字节，并且放弃了编译后代码的参数长度对齐，是为了尽可能地获得短小精悍的编译代码。
#### 2.11.1 数据类型与Java虚拟机
#### 2.11.2 加载和存储指令
#### 2.11.3 算术指令
#### 2.11.4 类型转换指令
#### 2.11.5 对象的创建与操作
#### 2.11.6 操作数栈管理指令
#### 2.11.7 控制转移指令
#### 2.11.8 方法调用和返回指令
#### 2.11.9 抛出异常
#### 2.11.10 同步

### 2.12 类库
Java虚拟机必须对JavaSE平台下的类库实现提供充分的支持。
* 反射
* 加载和创建类或接口的类
* 连接和初始化类或接口的类
* 安全
* 多线程
* 弱引用

### 2.13 公有设计、私有实现
Java虚拟机共同的**外观**：class文件格式以及字节码指令集等。这些内容与Java虚拟机的硬件独立性、操作系统的独立性以及实现独立性都是密切相关的。

实现者在本规范约束下对具体实现做出修改和优化也是完全可行的，并且也推荐这样做。

PS：设计原则，设计模式

## 第3章 Java虚拟机编译器
Java虚拟机是为支持Java编程语言而设计的。Oracle的JDK软件包括两部分：一部分是将Java源代码编译成Java虚拟机的指令集的编译器，
另一个部分是用于实现Java虚拟机的运行时环境。
### 3.1 示例的格式说明
### 3.2 常量、局部变量和控制结构的使用
### 3.3 算术运算
### 3.4 访问运行时常量池
### 3.5 与控制结构有关的更多示例
### 3.6 接收参数
### 3.7 方法调用
### 3.8 使用类实例
### 3.9 数组
### 3.10 编译switch语句
### 3.11 使用操作数栈
### 3.12 抛出异常和处理异常
### 3.13 编译finally语句块
### 3.14 同步
### 3.15 注解

## 第4章 class文件格式
每一个class文件都对应着唯一一个类或接口的定义信息，但是，类或接口并不一定都必须定义在文件里（比如类或接口也可以通过类加载器直接生成）。
### 4.1 ClassFile结构
### 4.2 各种名称的内部表示形式
### 4.3 描述符
### 4.4 常量池
### 4.5 字段
### 4.6 方法
### 4.7 属性
### 4.8 格式检查
### 4.9 Java虚拟机代码约束
### 4.10 class文件校验
### 4.11 Java虚拟机限制

## 第5章 加载、链接与初始化
* 加载是根据特定名称查找类或接口类型的二进制表示，并由此二进制表示来创建类或接口的过程。
* 链接是为了让类或接口可以被Java虚拟机执行，而将类或接口并入虚拟机运行时状态的过程。
* 类或接口的初始化是执行类或接口的初始化方法&lt;clinit&gt;

### 5.1 运行时常量池
### 5.2 虚拟机启动
### 5.3 创建和加载
#### 5.3.1 使用引导类加载器来加载类型
#### 5.3.2 使用用户自定义类加载器来加载类型
#### 5.3.3 创建数组类
#### 5.3.4 加载限制
#### 5.3.5 从class文件表示得到类
### 5.4 链接
#### 5.4.1 验证
#### 5.4.2 准备
#### 5.4.3 解析
#### 5.4.4 访问控制
#### 5.4.5 方法覆盖
### 5.5 初始化
### 5.6 绑定本地方法实现
### 5.7 Java虚拟机退出

## 第6章 Java虚拟机指令
一条Java虚拟机指令由一个指定要完成操作的操作码和表示待操作值的零个或多个操作数构成。

### 6.2 保留操作码
3个操作码被保留，只能用于Java虚拟机实现内部，不能出现在class文件之中。

| 操作码值  | 助记符     | 功能                                 |
| :-------- | :--------- | :----------------------------------- |
| 254(0xfe) | impdep1    | 以软件方式来提供一些与实现相关的功能 |
| 255(0xff) | impdep2    | 以硬件方式来提供一些与实现相关的功能 |
| 202(0xca) | breakpoint | 提供给调试器实现断点功能             |

### 6.3 虚拟机错误
VisualmachineError
* InternalError 实现虚拟机的软件错误、底层主机系统的软件错误及硬件错误
* OutOfMemoryError
* StackOverflowError
* UnknownError

### 6.4 指令描述格式
每行文字代表一个包含8个二进制的字节，表格名字就是指令的**助记符**，操作码通过数据表示。
class文件中的Java虚拟机代码只会出现数字形式的操作码，不会出现助记符。

操作数有可能会在编译期产生，并且嵌入到Java虚拟机的字节码指令中，也有可能会在运行期计算而得到，并加载到操作数栈中。

### 6.5 指令集描述

## 第7章 操作码助记符

| 分类     | 操作码 | 助记符 | 指令含义 |
| :------- | :----- | :----- | :------- |
| 常量     |        |        |          |
| 加载     |        |        |          |
| 存储     |        |        |          |
| 栈       |        |        |          |
| 数学     |        |        |          |
| 转换     |        |        |          |
| 比较     |        |        |          |
| 控制     |        |        |          |
| 引用     |        |        |          |
| 扩展     |        |        |          |
| 保留指令 |        |        |          |

## 附录A



